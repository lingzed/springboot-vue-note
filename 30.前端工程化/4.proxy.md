# proxy对象

`proxy`出现在vue.config.js文件中，是代理对象。它是`webpack-dev-server`的属性。`webpack-dev-server`是**本地开发服务器**，专门为**前端开发调试**服务的。它有众多配置，其中一项就是代理转发`proxy`。

`proxy`的作用是转发请求到后端从而实现跨域。`proxy`的每一项其实是一个对象，每个对象可以设置一些**属性**，主要有这些：

| 属性名         | 说明                                                         | 例子                              |
| -------------- | ------------------------------------------------------------ | --------------------------------- |
| `target`       | 要代理到的**后端服务器地址**。                               | `target: 'http://localhost:8080'` |
| `changeOrigin` | 是否**修改请求头**中的 origin。通常要写 `true`。防止后端拦截。 | `changeOrigin: true`              |
| `pathRewrite`  | **路径重写**，可以修改请求的 URL。                           | `pathRewrite: { '^/api': '' }`    |
| `ws`           | 支持**websocket**的代理。通常不写，默认 false。              | `ws: true`                        |

`proxy`每一项的名字叫做**匹配路径**，例如：

```js
proxy: {
  '/api': {
    target: 'http://localhost:12802',
    changeOrigin: true,
    pathRewrite: { '^/api': '' }
  }
}
```

这里 `/api` 就是匹配路径，作用就是告诉 `webpack-dev-server`：

> 凡是请求地址以 `/api` 开头的，通通给我代理到 `target` 指定的服务器去！

比如当前的请求是`http://localhost:12801/api/users`，代理之后，发送的请求实际上是`http://localhost:12802/users`。

## changeOrigin

`changeOrigin` 表示是否修改请求头中的 `origin`。

在传统的后端处理跨域中，后端通常通过请求头里的 `origin` 来判断是否允许跨域。具体来说，后端会检查请求的 `origin` 是否和自己的地址一致。如果不一致，就认为是跨域请求，需要额外配置允许的跨域地址（CORS 设置），否则会被拦截。

在使用代理的情况下，我们可以让代理服务器修改请求头，把 `origin` 改成后端服务器的地址。这样后端收到请求时，看到 `origin` 和自己的地址一致，就不会拦截，也不需要额外配置 CORS 了。

所以，**一般需要把 `changeOrigin` 设置为 `true`**，允许代理修改 `origin`，以绕过跨域问题。

## pathRewrite

`pathRewrite` 表示路径重写（路径替换），它是一个对象。对象的 **key** 是用于匹配路径的正则表达式，**value** 是替换成的内容。

它的作用是在代理请求时，**把请求路径中一部分内容替换掉**，以便能正确访问后端接口。

举个例子：

- 当前浏览器请求地址是：`http://localhost:12801/api/users`
- 后端真实接口地址是：`http://localhost:12802/users`

但是后端没有 `/api` 这一层路径，如果不处理，请求就会失败。

这时就需要用 `pathRewrite` 把 `/api` 这一段删掉，配置如下：

```js
pathRewrite: {
  '^/api': ''  // 匹配以 /api 开头的部分，并替换成空字符串
}
```

这样代理请求时，`/api/users` 就会被改成 `/users`，后端就能正确处理了。

## 请求地址不变

虽然 `proxy` 代理会把请求转发到实际后端服务器，但在浏览器的开发者工具里，**看到的请求地址仍然是代理之前的地址**。

正因为浏览器看到的是代理前的地址（比如 `localhost:12801`），它才认为是**同源**的，不会报跨域错误。

**注意**：你在浏览器里**看不到代理后的真实地址**。因为代理是在开发服务器（webpack-dev-server）这一层完成的，对浏览器是“透明”的。

如果想确认代理成功了，可以通过两种方式验证：

1. 后端服务器日志里能看到对应的请求记录。
2. 浏览器网络请求（Network）中查看响应内容，能拿到后端返回的数据，说明代理生效了。
